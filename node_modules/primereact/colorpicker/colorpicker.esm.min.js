import*as e from"react";import n,{PrimeReactContext as r}from"primereact/api";import{ComponentBase as t,useHandleStyle as o}from"primereact/componentbase";import{useMergeProps as i,useOverlayListener as l,useEventListener as c,useMountEffect as a,useUpdateEffect as u,useUnmountEffect as p}from"primereact/hooks";import{OverlayService as s}from"primereact/overlayservice";import{Tooltip as f}from"primereact/tooltip";import{classNames as d,DomHandler as m,ObjectUtils as h,ZIndexUtils as b}from"primereact/utils";import{CSSTransition as g}from"primereact/csstransition";import{Portal as y}from"primereact/portal";function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function x(e,n){if("object"!==v(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var t=r.call(e,n||"default");if("object"!==v(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}function k(e){var n=x(e,"string");return"symbol"===v(n)?n:String(n)}function w(){return w=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e},w.apply(this,arguments)}function E(e){if(Array.isArray(e))return e}function O(e,n){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var t,o,i,l,c=[],a=!0,u=!1;try{if(i=(r=r.call(e)).next,0===n){if(Object(r)!==r)return;a=!1}else for(;!(a=(t=i.call(r)).done)&&(c.push(t.value),c.length!==n);a=!0);}catch(e){u=!0,o=e}finally{try{if(!a&&null!=r.return&&(l=r.return(),Object(l)!==l))return}finally{if(u)throw o}}return c}}function S(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function M(e,n){if(e){if("string"==typeof e)return S(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?S(e,n):void 0}}function C(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function N(e,n){return E(e)||O(e,n)||M(e,n)||C()}var P=t.extend({defaultProps:{__TYPE:"ColorPicker",appendTo:null,autoFocus:!1,children:void 0,className:null,defaultColor:"ff0000",disabled:!1,format:"hex",id:null,inline:!1,inputClassName:null,inputId:null,inputRef:null,inputStyle:null,onChange:null,onHide:null,onShow:null,panelClassName:null,panelStyle:null,style:null,tabIndex:null,tooltip:null,tooltipOptions:null,transitionOptions:null,value:null},css:{classes:{root:function(e){return d("p-colorpicker p-component",{"p-colorpicker-overlay":!e.props.inline})},input:function(e){var n=e.props;return d("p-colorpicker-preview p-inputtext",n.inputClassName,{"p-disabled":n.disabled})},panel:function(e){var r=e.panelProps,t=e.context;return d("p-colorpicker-panel",r.panelClassName,{"p-colorpicker-overlay-panel":!r.inline,"p-disabled":r.disabled,"p-input-filled":t&&"filled"===t.inputStyle||"filled"===n.inputStyle,"p-ripple-disabled":t&&!1===t.ripple||!1===n.ripple})},content:"p-colorpicker-content",hueHandle:"p-colorpicker-hue-handle",hue:"p-colorpicker-hue",colorHandle:"p-colorpicker-color-handle",color:"p-colorpicker-color",selector:"p-colorpicker-color-selector",transition:"p-connected-overlay"},styles:"\n@layer primereact {\n    .p-colorpicker {\n        display: inline-block;\n    }\n    \n    .p-colorpicker-dragging {\n        cursor: pointer;\n    }\n    \n    .p-colorpicker-overlay {\n        position: relative;\n    }\n    \n    .p-colorpicker-panel {\n        position: relative;\n        width: 193px;\n        height: 166px;\n    }\n    \n    .p-colorpicker-overlay-panel {\n        position: absolute;\n        top: 0;\n        left: 0;\n    }\n    \n    .p-colorpicker-preview {\n        cursor: pointer;\n    }\n    \n    .p-colorpicker-panel .p-colorpicker-content {\n        position: relative;\n    }\n    \n    .p-colorpicker-panel .p-colorpicker-color-selector {\n        width: 150px;\n        height: 150px;\n        top: 8px;\n        left: 8px;\n        position: absolute;\n    }\n    \n    .p-colorpicker-panel .p-colorpicker-color {\n        width: 150px;\n        height: 150px;\n    }\n    \n    .p-colorpicker-panel .p-colorpicker-color-handle {\n        position: absolute;\n        top: 0px;\n        left: 150px;\n        border-radius: 100%;\n        width: 10px;\n        height: 10px;\n        border-width: 1px;\n        border-style: solid;\n        margin: -5px 0 0 -5px;\n        cursor: pointer;\n        opacity: 0.85;\n    }\n    \n    .p-colorpicker-panel .p-colorpicker-hue {\n        width: 17px;\n        height: 150px;\n        top: 8px;\n        left: 167px;\n        position: absolute;\n        opacity: 0.85;\n    }\n    \n    .p-colorpicker-panel .p-colorpicker-hue-handle {\n        position: absolute;\n        top: 150px;\n        left: 0px;\n        width: 21px;\n        margin-left: -2px;\n        margin-top: -5px;\n        height: 10px;\n        border-width: 2px;\n        border-style: solid;\n        opacity: 0.85;\n        cursor: pointer;\n    }\n    \n    .p-colorpicker-panel .p-colorpicker-color {\n        background: linear-gradient(to top, #000 0%, rgb(0 0 0 / 0) 100%), linear-gradient(to right, #fff 0%, rgb(255 255 255 / 0) 100%)\n    }\n    .p-colorpicker-panel .p-colorpicker-hue {\n        background: linear-gradient(0deg, red 0, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, red)\n    }\n}\n"}}),T=e.forwardRef((function(n,t){var o,l,c=i(),a=e.useContext(r),u=n.ptm,p=n.cx,s=(o=c({className:p("panel",{panelProps:n,context:a}),style:n.panelStyle,onClick:n.onClick},u("panel",{hostName:n.hostName})),l=c({classNames:p("transition"),in:n.in,timeout:{enter:120,exit:100},options:n.transitionOptions,unmountOnExit:!0,onEnter:n.onEnter,onEntered:n.onEntered,onExit:n.onExit,onExited:n.onExited},u("transition",{hostName:n.hostName})),e.createElement(g,w({nodeRef:t},l),e.createElement("div",w({ref:t},o),n.children)));return n.inline?s:e.createElement(y,{element:s,appendTo:n.appendTo})}));function j(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function R(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?j(Object(r),!0).forEach((function(n){var t,o,i;t=e,i=r[n],(o=k(o=n))in t?Object.defineProperty(t,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}T.displayName="ColorPickerPanel";var I=e.memo(e.forwardRef((function(t,g){var y=i(),v=e.useContext(r),x=P.getProps(t,v),k=N(e.useState(!1),2),E=k[0],O=k[1],S=P.setMetaData({props:x,state:{overlayVisible:E}}),M=S.ptm,C=S.cx,j=S.isUnstyled;o(P.css.styles,j,{name:"colorpicker"});var I=e.useRef(null),D=e.useRef(null),H=e.useRef(x.inputRef),Y=e.useRef(null),A=e.useRef(null),F=e.useRef(null),z=e.useRef(null),B=e.useRef(!1),U=e.useRef(null),X=e.useRef(!1),Z=N(l({target:I,overlay:D,listener:function(e,n){n.valid&&he()},when:E}),2),_=Z[0],K=Z[1],L=N(c({type:"mousemove",listener:function(e){X.current&&ie(e),B.current&&W(e)}}),2),V=L[0],$=L[1],q=N(c({type:"mouseup",listener:function(){X.current=B.current=!1,m.removeClass(I.current,"p-colorpicker-dragging"),$(),J()}}),2),G=q[0],J=q[1],Q=function(e){x.disabled||(B.current=!0,W(e),!j&&m.addClass(I.current,"p-colorpicker-dragging"))},W=function(e){var n=z.current.getBoundingClientRect().top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0);U.current=ve({h:Math.floor(360*(150-Math.max(0,Math.min(150,(e.pageY||e.changedTouches[0].pageY)-n)))/150),s:100,b:100}),pe(),fe(),le()},ee=function(e){x.disabled||(X.current=!0,ie(e),!j&&m.addClass(I.current,"p-colorpicker-dragging"),e.preventDefault())},ne=function(e){X.current&&(ie(e),e.preventDefault()),B.current&&(W(e),e.preventDefault())},re=function(){X.current=!1,B.current=!1,!j&&m.removeClass(I.current,"p-colorpicker-dragging"),oe()},te=function(){V(),G()},oe=function(){$(),J()},ie=function(e){var n=Y.current.getBoundingClientRect(),r=n.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),t=n.left+document.body.scrollLeft,o=Math.floor(100*Math.max(0,Math.min(150,(e.pageX||e.changedTouches[0].pageX)-t))/150),i=Math.floor(100*(150-Math.max(0,Math.min(150,(e.pageY||e.changedTouches[0].pageY)-r)))/150);U.current=ve({h:U.current.h,s:o,b:i}),se(),de(),le()},le=function(){switch(x.format){case"hex":ue(Se(U.current));break;case"rgb":ue(Ee(U.current));break;case"hsb":ue(U.current)}},ce=function(e){var n;if(e)switch(x.format){case"hex":n=ke(e);break;case"rgb":n=we(e);break;case"hsb":n=e}else n=ke(x.defaultColor);return n},ae=function(e){U.current=ce(e)},ue=function(e){x.onChange&&x.onChange({value:e,stopPropagation:function(){},preventDefault:function(){},target:{name:x.name,id:x.id,value:e}})},pe=function(){if(Y.current){var e=ve({h:U.current.h,s:100,b:100});Y.current.style.backgroundColor="#"+Se(e)}},se=function(){A.current&&(A.current.style.left=Math.floor(150*U.current.s/100)+"px",A.current.style.top=Math.floor(150*(100-U.current.b)/100)+"px")},fe=function(){F.current&&(F.current.style.top=Math.floor(150-150*U.current.h/360)+"px")},de=function(){H.current&&(H.current.style.backgroundColor="#"+Se(U.current))},me=function(){O(!0)},he=function(){O(!1)},be=function(){ge()},ge=function(){E?he():me()},ye=function(e){switch(e.which){case 32:ge(),e.preventDefault();break;case 27:case 9:he()}},ve=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},xe=function(e){var n=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:n>>16,g:(65280&n)>>8,b:255&n}},ke=function(e){return we(xe(e))},we=function(e){var n={h:0,s:0,b:0},r=Math.min(e.r,e.g,e.b),t=Math.max(e.r,e.g,e.b),o=t-r;return n.b=t,n.s=0!==t?255*o/t:0,n.h=0!==n.s?e.r===t?(e.g-e.b)/o:e.g===t?2+(e.b-e.r)/o:4+(e.r-e.g)/o:-1,n.h=60*n.h,n.h<0&&(n.h=n.h+360),n.s=n.s*(100/255),n.b=n.b*(100/255),n},Ee=function(e){var n={r:null,g:null,b:null},r=Math.round(e.h),t=Math.round(255*e.s/100),o=Math.round(255*e.b/100);if(0===t)n={r:o,g:o,b:o};else{var i=o,l=(255-t)*o/255,c=r%60*(i-l)/60;360===r&&(r=0),r<60?(n.r=i,n.b=l,n.g=l+c):r<120?(n.g=i,n.b=l,n.r=i-c):r<180?(n.g=i,n.r=l,n.b=l+c):r<240?(n.b=i,n.r=l,n.g=i-c):r<300?(n.b=i,n.g=l,n.r=l+c):r<360?(n.r=i,n.g=l,n.b=i-c):(n.r=0,n.g=0,n.b=0)}return{r:Math.round(n.r),g:Math.round(n.g),b:Math.round(n.b)}},Oe=function(e){var n=[e.r.toString(16),e.g.toString(16),e.b.toString(16)];for(var r in n)1===n[r].length&&(n[r]="0"+n[r]);return n.join("")},Se=function(e){return Oe(Ee(e))},Me=function(){fe(),se(),de(),pe()},Ce=function(){H.current&&m.alignOverlay(D.current,H.current.parentElement,x.appendTo||v&&v.appendTo||n.appendTo)};e.useImperativeHandle(g,(function(){return{props:x,show:me,hide:he,focus:function(){return m.focus(H.current)},getElement:function(){return I.current},getOverlay:function(){return D.current},getInput:function(){return H.current}}})),e.useEffect((function(){h.combinedRefs(H,x.inputRef)}),[H,x.inputRef]),a((function(){ae(x.value),Me(),x.autoFocus&&m.focus(H.current,x.autoFocus),Ce()})),u((function(){X.current||B.current||ae(x.value)}),[x.value]),u((function(){Me()})),p((function(){b.clear(D.current)}));var Ne,Pe,Te,je,Re,Ie,De,He,Ye=h.isNotEmpty(x.tooltip),Ae=(Ne=y({ref:Y,className:C("selector"),onMouseDown:function(e){return n=e,void(x.disabled||(te(),ee(n)));var n},onTouchStart:function(e){return ee(e)},onTouchMove:function(e){return ne(e)},onTouchEnd:re},M("selector")),Pe=y({className:C("color")},M("color")),Te=y({ref:A,className:C("colorHandle")},M("colorHandle")),Ie=e.createElement("div",Ne,e.createElement("div",Pe,e.createElement("div",Te))),je=y({className:C("hue"),onMouseDown:function(e){return n=e,void(x.disabled||(te(),Q(n)));var n},onTouchStart:function(e){return Q(e)},onTouchMove:function(e){return ne(e)},onTouchEnd:re},M("hue")),Re=y({className:C("hueHandle")},M("hueHandle")),De=e.createElement("div",w({ref:z},je),e.createElement("div",w({ref:F},Re))),He=y({className:C("content")},M("content")),e.createElement("div",He,Ie,De)),Fe=function(){if(!x.inline){var n=P.getOtherProps(x),r=y(R({ref:H,type:"text",readOnly:!0,className:C("input"),style:x.inputStyle,id:x.inputId,tabIndex:x.tabIndex,disabled:x.disabled,onClick:be,onKeyDown:ye},n),M("input"));return e.createElement("input",r)}return null}(),ze=y({id:x.id,ref:I,style:x.style,className:d(x.className,C("root"))},P.getOtherProps(x),M("root"));return e.createElement(e.Fragment,null,e.createElement("div",ze,Fe,e.createElement(T,{hostName:"ColorPicker",ref:D,appendTo:x.appendTo,inline:x.inline,disabled:x.disabled,panelStyle:x.panelStyle,panelClassName:x.panelClassName,onClick:function(e){x.inline||s.emit("overlay-click",{originalEvent:e,target:I.current})},in:x.inline||E,onEnter:function(){var e=x.inline?void 0:{position:"absolute",top:"0",left:"0"};b.set("overlay",D.current,v&&v.autoZIndex||n.autoZIndex,v&&v.zIndex.overlay||n.zIndex.overlay),m.addStyles(D.current,e),Ce()},onEntered:function(){_(),x.onShow&&x.onShow()},onExit:function(){K()},onExited:function(){b.clear(D.current),x.onHide&&x.onHide()},transitionOptions:x.transitionOptions,ptm:M,cx:C},Ae)),Ye&&e.createElement(f,w({target:I,content:x.tooltip,pt:M("tooltip")},x.tooltipOptions)))})));I.displayName="ColorPicker";export{I as ColorPicker};
